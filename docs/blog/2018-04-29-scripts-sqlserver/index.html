<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="description" content="Les comparto algunos scripts que me sirvieron de mucho durante el tiempo que llevo trabajando, y es más aún los sigo usando.">
    <meta name="keywords" content="[JavaScript jquery C# PHP SQLServer Sistemas Codigo fuente Código fuente]">
    <meta name="author" content="Hugo Roca">
    
    <title>Scripts SQLServer</title>
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/webmag.css">
    
    <link href="//fonts.googleapis.com/css?family=Nunito+Sans:700%7CNunito:300,600" rel="stylesheet"> 
    
    <link href="http://example.com/favicon.png" rel="icon">
    
    <meta name="generator" content="Hugo 0.48" />
    
    
    
    
    

  
    <meta name="twitter:card" content="summary"/>
  
  
  <meta name="twitter:title" content="Scripts SQLServer"/>
  <meta name="twitter:description" content="Les comparto algunos scripts que me sirvieron de mucho durante el tiempo que llevo trabajando, y es más aún los sigo usando."/>
  <meta name="twitter:site" content="@https://hugorocaproyectos.js.org"/>
  <meta name="twitter:domain" content="parsiya.net"/>
  <meta name="twitter:creator" content="@HuugooRoca"/>

    
</head>

<body>
    <header id="header">
        <div id="nav">
    <div id="nav-fixed">
        <div class="container">
            <div class="nav-logo">
                <a href="index.html" class="logo"><img src="/logo.png" alt=""></a>
            </div>

            <ul class="nav-menu nav navbar-nav">
    
    
    <li>
    
    
    
    
    
    
        <a href="http://example.com/" title="Inicio">Inicio</a>
    </li>
    
    
    
    <li class="cat-javascript">
    
    
    
    
    
        <a href="http://example.com/categories/javascript/" title="JavaScript">JavaScript</a>
    </li>
    
    
    
    
    
    <li class="cat-csharp">
    
    
    
        <a href="http://example.com/categories/c-sharp/" title="C Sharp">C Sharp</a>
    </li>
    
    
    
    
    
    
    
    <li class="cat-php">
    
        <a href="http://example.com/categories/php" title="PHP">PHP</a>
    </li>
    
    
    
    
    
    
    <li class="cat-basedatos">
    
    
        <a href="http://example.com/categories/base-de-datos" title="Base de datos">Base de datos</a>
    </li>
    
    
    
    
    <li class="cat-sistemas">
    
    
    
    
        <a href="http://example.com/categories/sistemas/" title="Sistemas">Sistemas</a>
    </li>
    
</ul>

<div class="nav-btns">
    <button class="aside-btn"><i class="fa fa-bars"></i></button>
    
</div>

        </div>
    </div>

    <div id="nav-aside">
        <div class="section-row">
    <ul class="nav-aside-menu">
        
        
        <li><a href="https://hugoroca.github.io" target="_blank" title="Acerca de mí">Acerca de mí</a></li>
        
        
        
        <li><a href="http://example.com/" title="Inicio">Inicio</a></li>
        
        
    </ul>
</div>

        


    <div class="section-row">
        <h3>Post Recientes</h3>
        
        
            
                <div class="post post-widget">
                    <a class="post-img" href="/blog/2018-10-02-gr%C3%A1ficos-con-d3js/"><img src="/images/post/d3js.jpg" alt=""></a>
                    <div class="post-body">
                        <h3 class="post-title"><a href="/blog/2018-10-02-gr%C3%A1ficos-con-d3js/">Gráficos con D3JS</a></h3>
                    </div>
                </div>
            
        
            
                <div class="post post-widget">
                    <a class="post-img" href="/blog/2018-09-15-programaci%C3%B3n-orientada-a-objetos/"><img src="/images/post/POO.jpg" alt=""></a>
                    <div class="post-body">
                        <h3 class="post-title"><a href="/blog/2018-09-15-programaci%C3%B3n-orientada-a-objetos/">Programación Orientada a Objetos</a></h3>
                    </div>
                </div>
            
        
            
                <div class="post post-widget">
                    <a class="post-img" href="/blog/2018-09-01-app-restaurante/"><img src="/images/post/apprestaurante.jpg" alt=""></a>
                    <div class="post-body">
                        <h3 class="post-title"><a href="/blog/2018-09-01-app-restaurante/">APP Restaurante</a></h3>
                    </div>
                </div>
            
        
            
                <div class="post post-widget">
                    <a class="post-img" href="/blog/2018-05-20-registro-de-errores-con-log4net/"><img src="/images/post/log4net.jpg" alt=""></a>
                    <div class="post-body">
                        <h3 class="post-title"><a href="/blog/2018-05-20-registro-de-errores-con-log4net/">Registro de errores con Log4Net</a></h3>
                    </div>
                </div>
            
        
    </div>



        <div class="section-row">
            <h3>Sigueme</h3>
            <ul class="nav-aside-social">
                
                <li><a target="_blank" href="https://github.com/HugoRoca" title="https://github.com/HugoRoca"><i class="fa fa-github"></i></a></li>
                

                

                

                
                <li><a target="_blank" href="https://twitter.com/HuugooRoca" title="https://twitter.com/HuugooRoca"><i class="fa fa-twitter"></i></a></li>
                

                
                <li><a target="_blank" href="https://www.linkedin.com/in/hugoroca/" title="https://www.linkedin.com/in/hugoroca/"><i class="fa fa-linkedin"></i></a></li>
                

                

                

                

                

                

                

                
            </ul>
        </div>

        <button class="nav-aside-close"><i class="fa fa-times"></i></button>
    </div>
</div>

        <div id="post-header" class="page-header">
            <div class="background-img" style="background-image: url('/images/post/scripts-sql.jpg');"></div>
            <div class="container">
                <div class="row">
                    <div class="col-md-10">
                        <div class="post-meta">
                            
    
        
        
        
        
        <a class="post-category cat-basedatos" href="http://example.com/categories/base-de-datos/">Base de datos </a>
        
        
    

                            <span class="post-date">Apr 29, 2018</span>
                        </div>
                        <h1>Scripts SQLServer</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>

<div class="section">
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <div class="section-row sticky-container">
                    <div class="main-post">
                        
                        
                        
                        

<p>Les comparto algunos scripts que me sirvieron de mucho durante el tiempo que llevo trabajando, y es más aún los sigo usando.</p>

<h2 id="split">Split</h2>

<pre><code>-- select * from dbo.[Split]('1,2,3,4,5,6',',')
CREATE FUNCTION [dbo].[Split] (
    @ItemList NVARCHAR(MAX)
    ,@delimiter CHAR(1)
    )
RETURNS @IDTable TABLE (
    nro INT identity(1, 1)
    ,Item VARCHAR(MAX)
    )
AS
BEGIN
    DECLARE @tempItemList NVARCHAR(MAX)
    SET @tempItemList = @ItemList
    DECLARE @i INT
    DECLARE @Item NVARCHAR(MAX)
         
    SET @i = CHARINDEX(@delimiter, @tempItemList)

    WHILE (LEN(@tempItemList) &gt; 0)
    BEGIN
        IF @i = 0
            SET @Item = @tempItemList
        ELSE
            SET @Item = LEFT(@tempItemList, @i - 1)

        INSERT INTO @IDTable (Item)
        VALUES (@Item)

        IF @i = 0
            SET @tempItemList = ''
        ELSE
            SET @tempItemList = RIGHT(@tempItemList, LEN(@tempItemList) - @i)

        SET @i = CHARINDEX(@delimiter, @tempItemList)
    END

    RETURN
END
</code></pre>

<h2 id="encriptación">Encriptación</h2>

<p>Recomendado para contraseñas y/o datos sensibles.</p>

<pre><code>CREATE FUNCTION dbo.EncriptarClave (@Clave NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN
    SET @Clave = UPPER(@Clave)

    DECLARE @ClaveEncriptada NVARCHAR(MAX);

    SELECT
        @ClaveEncriptada = UPPER(
            SUBSTRING(master.dbo.fn_varbintohexstr(HASHBYTES('SHA1', @Clave)), 3, 40)
            );

    RETURN @ClaveEncriptada;
END
/*SELECT dbo.EncriptarClave('HUGO')
Esto no es reversible, una vez encriptada ya no se puede desencriptar, se recomienda guardar log.
*/
</code></pre>

<h2 id="exists-store-function-index">Exists store, function, index</h2>

<pre><code>IF EXISTS(SELECT * FROM sys.SYSOBJECTS A INNER JOIN SYS.SCHEMAS B ON A.uid =B.schema_id 
    WHERE A.NAME='Gen_SelBandejaProducto_SP' 
        AND B.name='dbo')
 DROP PROCEDURE Gen_SelBandejaProducto_SP 
GO

-- para indeces 
IF EXISTS (SELECT * FROM sys.indexes 
    WHERE name='Cedula_INDEX' 
        AND object_id = OBJECT_ID('CertificadoTributarioDetalle'))
BEGIN
    DROP INDEX Cedula_INDEX ON dbo.CertificadoTributarioDetalle; 
END
</code></pre>

<h2 id="formato-miles">Formato miles</h2>

<pre><code>select CONVERT(varchar(50), CONVERT(money, 12345.6), 1)
</code></pre>

<h2 id="try-catch">Try Catch</h2>

<pre><code>BEGIN
BEGIN TRY
BEGIN TRANSACTION  
BEGIN
&lt;&lt;Cuerpo de procedimiento&gt;&gt;
END
COMMIT TRAN
END TRY
BEGIN CATCH
    IF @@TRANCOUNT &gt; 0
    BEGIN
        ROLLBACK TRAN
    END
DECLARE @nLinea INT=ERROR_LINE()                            
DECLARE @cError VARCHAR(8000)=ERROR_MESSAGE()                            
DECLARE @cStored varchar(500)=(SELECT TOP 1 name FROM sys.objects 
                                WHERE object_id=@@PROCID)                                           
    EXEC SIS_RegitrarError @nLinea, @cError, @cStored
END CATCH
END 

/**************************/
CREATE PROCEDURE [dbo].[SIS_RegitrarError] @nLineaError INT
    ,@cDescrip VARCHAR(8000)
    ,@cNombreStore VARCHAR(500)
AS
BEGIN
    INSERT INTO Errores (
        dFecha
        ,nLineaError
        ,cDescrip
        ,cDatos
        ,cStore
        )
    VALUES (
        GETDATE()
        ,@nLineaError
        ,@cDescrip
        ,CONVERT(VARCHAR(50), HOST_NAME() + ' - ' + SUSER_SNAME(SUSER_SID()))
        ,@cNombreStore
        )     
END
</code></pre>

<h2 id="select-xml">Select XML</h2>

<pre><code>DECLARE @oData XML = '&lt;GENESYS&gt;&lt;DATA nombre=&quot;Hugo&quot; apellido=&quot;Roca&quot; /&gt;&lt;/GENESYS&gt;'
DECLARE @nDoc int
EXEC sp_xml_preparedocument @nDoc OUTPUT,@oData
SELECT *    
FROM openxml(@nDoc, '/GENESYS/DATA', 1) 
WITH (
    nombre varchar(50), 
    apellido varchar(50)
)
</code></pre>

<h2 id="buscar-tabla-en-store">Buscar tabla en store</h2>

<pre><code>SELECT Name
FROM sys.procedures
WHERE OBJECT_DEFINITION(OBJECT_ID) LIKE '%table%'
Go

------
SELECT DISTINCT so.name
FROM syscomments sc
INNER JOIN sysobjects so ON sc.id=so.id
WHERE sc.TEXT LIKE '%table%'
Go

----- Con tipo, si es store o function
SELECT DISTINCT o.name, o.xtype
FROM syscomments c
INNER JOIN sysobjects o ON c.id=o.id
WHERE c.TEXT LIKE '%SolicitudCredito%'
go
</code></pre>

<h2 id="ceros-a-la-izquierda">Ceros a la izquierda</h2>

<pre><code>select RIGHT('0000000000' + Ltrim(Rtrim('987654')),10)
</code></pre>

<h2 id="enviar-correo">Enviar correo</h2>

<pre><code>CREATE PROCEDURE [dbo].[PA_EnviarCorreoDBA] @pcTo AS VARCHAR(255)
    ,@pcCC AS VARCHAR(255)
    ,@pcSubject AS VARCHAR(255)
    ,@pcMessage AS VARCHAR(max)
AS
BEGIN
    EXEC msdb..sp_send_dbmail @profile_name = 'Database Management'
        ,@recipients = @pcTo
        ,@copy_recipients = @pcCC
        ,@subject = @pcSubject
        ,@body = @pcMessage
END
</code></pre>

<h2 id="config-de-parametros">Config de parametros</h2>

<pre><code>CREATE PROCEDURE dbo.SCC_Configurar_Parametros
AS
--ACTIVAR VOLCADO DE DATOS A ARCHIVOS PLANOS  
EXEC sp_configure 'show advanced options',1;

-- To update the currently configured value for advanced options.  
RECONFIGURE
WITH OVERRIDE;

-- To enable the feature.  
EXEC sp_configure 'xp_cmdshell',1;

-- To update the currently configured value for this feature.  
RECONFIGURE
WITH OVERRIDE;

/************************/
CREATE PROCEDURE dbo.SCC_Configurar_Parametros_Cerrar
AS
-- To enable the feature.  
EXEC sp_configure 'xp_cmdshell',0;

-- To update the currently configured value for this feature.  
RECONFIGURE
WITH OVERRIDE;

--ACTIVAR VOLCADO DE DATOS A ARCHIVOS PLANOS  
EXEC sp_configure 'show advanced options',0;

-- To update the currently configured value for advanced options.  
RECONFIGURE
WITH OVERRIDE;
</code></pre>

<p>Comenta, disfruta y comparte!</p>

                    </div>
                    <div class="post-shares sticky-shares">
                        <a href="#" class="share-facebook"><i class="fa fa-facebook"></i></a>
                        <a href="#" class="share-twitter"><i class="fa fa-twitter"></i></a>
                        <a href="#" class="share-google-plus"><i class="fa fa-google-plus"></i></a>
                        <a href="#" class="share-pinterest"><i class="fa fa-pinterest"></i></a>
                        <a href="#" class="share-linkedin"><i class="fa fa-linkedin"></i></a>
                        <a href="#"><i class="fa fa-envelope"></i></a>
                    </div>
                </div>

                <div class="section-row">
                    
                    <div class="post-comments">
                        <div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
      
      
      
      if (window.location.hostname == "localhost")
          return;
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'hugorocaproyectos';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                    </div>
                </div>

            </div>
            <div class="col-md-4">
                <div class="aside-widget text-center">
    <a href="#" style="display: inline-block;margin: auto;">
        <img class="img-responsive" src="/ad-1.jpg" alt="">
    </a>
</div>


    
        <div class="aside-widget">
            <div class="section-title">
                <h2>Post Recientes</h2>
            </div>
            
            
                
                    <div class="post post-thumb">
                            <a class="post-img" href="/blog/2018-10-02-gr%C3%A1ficos-con-d3js/"><img src="/images/post/d3js.jpg" alt=""></a>
                        <div class="post-body">
                            <div class="post-meta">
                                
    
        
        <a class="post-category cat-javascript" href="http://example.com/categories/javascript/">JavaScript </a>
        
        
        
        
        
    

                                <span class="post-date">Oct 2, 2018</span>
                            </div>
                            <h3 class="post-title"><a href="/blog/2018-10-02-gr%C3%A1ficos-con-d3js/">Gráficos con D3JS</a></h3>
                        </div>
                    </div>
                
            
                
                    <div class="post post-thumb">
                            <a class="post-img" href="/blog/2018-09-15-programaci%C3%B3n-orientada-a-objetos/"><img src="/images/post/POO.jpg" alt=""></a>
                        <div class="post-body">
                            <div class="post-meta">
                                
                                <span class="post-date">Sep 15, 2018</span>
                            </div>
                            <h3 class="post-title"><a href="/blog/2018-09-15-programaci%C3%B3n-orientada-a-objetos/">Programación Orientada a Objetos</a></h3>
                        </div>
                    </div>
                
            
        </div>
    


<div class="aside-widget">
    <div class="section-title">
        <h2>Categorías</h2>
    </div>
    <div class="category-widget">
        <ul>
            
            
                
                
                
                
                <li><a class="cat-basedatos" href="http://example.com/categories/base-de-datos">Base de datos<span>3</span></a></li>
                
                
            
            
                
                
                
                <li><a class="cat-csharp" href="http://example.com/categories/c-sharp">C Sharp<span>4</span></a></li>
                
                
                
            
            
                
                <li><a class="cat-javascript" href="http://example.com/categories/javascript">JavaScript<span>5</span></a></li>
                
                
                
                
                
            
            
                
                
                
                
                
                <li><a class="cat-php" href="http://example.com/categories/php">PHP<span>2</span></a></li>
                
            
            
                
                
                <li><a class="cat-sistemas" href="http://example.com/categories/sistemas">Sistemas<span>4</span></a></li>
                
                
                
                
            
        </ul>
    </div>
</div>

<div class="aside-widget">
    <div class="section-title">
        <h2>Tags</h2>
    </div>
    <div class="tags-widget">
        <ul>
            
                <li>
                    <a href="http://example.com/tags/angularjs">angularjs</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/csharp">csharp</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/css3">css3</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/html5">html5</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/jquery">jquery</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/js">js</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/php">php</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/poo">poo</a>
                </li>
            
                <li>
                    <a href="http://example.com/tags/sqlserver">sqlserver</a>
                </li>
            
        </ul>
    </div>
</div>
            </div>
        </div>
    </div>
</div>



<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5">
                <div class="footer-widget">
                    <div class="footer-logo">
                        <a href="/" class="logo"><img src="/logo.png" alt=""></a>
                    </div>
                    <div class="footer-copyright">
                        <span>&copy;
                            Copyright &copy;
                            <script>document.write(new Date().getFullYear());</script> 
                            Todos los derechos reservados <br>
                            Esta plantilla fue hecha <i class="fa fa-heart-o" aria-hidden="true"></i> 
                            por <a href="https://colorlib.com" target="_blank">Colorlib</a> 
                            y modificada <a href="https://gohugo.io/news/" target="_blank"> por goHugo</a> y <a href="https://hugoroca.github.io" target="_blank">Hugo Roca</a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="row">
                    <div class="col-md-6">
                        <div class="footer-widget">
                            <h3 class="footer-title">Acerca de mi</h3>
                            <ul class="footer-links">
                                <li><a href="about.html">Acerca de mi</a></li>
                                <li><a href="contact.html">Contacts</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="footer-widget">
                            <h3 class="footer-title">Categorias</h3>
                            <ul class="footer-links">
                                
                                    
                                    
                                    
                                        <li><a href="http://example.com/categories/base-de-datos">Base de datos</a></li>
                                    
                                    
                                    
                                    
                                
                                    
                                    
                                    
                                    
                                        <li><a href="http://example.com/categories/c-sharp">C Sharp</a></li>
                                    
                                    
                                    
                                
                                    
                                    
                                        <li><a href="http://example.com/categories/javascript">JavaScript</a></li>
                                    
                                    
                                    
                                    
                                    
                                
                                    
                                    
                                    
                                    
                                    
                                        <li><a href="http://example.com/categories/php">PHP</a></li>
                                    
                                    
                                
                                    
                                    
                                    
                                    
                                    
                                    
                                        <li><a href="http://example.com/categories/sistemas">Sistemas</a></li>
                                    
                                
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="footer-widget">
                    <h3 class="footer-title">Sigueme</h3>
                    <ul class="footer-social">
                        <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                        <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                        <li><a href="#"><i class="fa fa-pinterest"></i></a></li>
                    </ul>
                </div>
            </div>

        </div>
        
    </div>
    
</footer>



<script src="/js/jquery.js"></script>
<script src="/js/bootstrap.js"></script>
<script src="/js/main.js"></script>

</body>

</html>